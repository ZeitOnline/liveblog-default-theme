{% macro translate(text) %}{% if not options.i18n[settings.language] %}{{ text }}{% elif not options.i18n[settings.language][text] %}{{ text }}{% else %}{{ options.i18n[settings.language][text] }}{% endif %}{% endmacro %}
{% set mainItem = item.groups[1].refs[0].item %}
{% set postDate = item.published_date %}
{% set type = item.post_items_type %}
{% set galleryItem = false %}

{% if mainItem.commenter %}
  {% if item.groups[1].refs|length > 1 %}
    {% set type = 'comment' %}
  {% endif %}
  {% set postDate = mainItem._created %}
  {% if mainItem.meta._created %}
    {% set postDate = mainItem.meta._created %}
  {% endif %}
{% endif %}

<!-- sticky position toggle -->
{% if item.sticky and settings.stickyPosition == 'top' %}
<article
  class="lb-sticky-top-post list-group-item {{ type }} {% if displaynone %}mod--displaynone{% endif %}"
  data-post-id="{{ item._id }}"
  data-post-sticky="{{ item.sticky }}">
  {% else %}
<article
  class="lb-post list-group-item show-author-avatar {{ type }} {% if item.lb_highlight %}lb-post--highlighted{% endif %} {% if displaynone %}mod--displaynone{% endif %}"
  data-post-id="{{ item._id }}"
  data-post-sticky="{{ item.sticky }}">
  <div class="lb-post-header">

    <div class="lb-type lb-type--{{ item.post_items_type }}"></div>
    <div class="lb-post-metadata">
      <!-- remove advertisement stylization-->
      {% if item.post_items_type != "advertisement" %}

      {% if item.sticky and item.lb_highlight and settings.hasHighlights %}
        <span class="lb-post-metadata__status lb-post-metadata__status--pinned"></span>
        <span class="lb-post-metadata__status lb-post-metadata__status--highlighted"></span>
      {% elif item.sticky %}
        <span class="lb-post-metadata__status lb-post-metadata__status--pinned"></span>
      {% elif item.lb_highlight and settings.hasHighlights  %}
        <span class="lb-post-metadata__status lb-post-metadata__status--highlighted"></span>
      {% elif item.post_items_type == "advertisement" %}
        <div class="lb-advertisement">{{ translate('Advertisement') }}</div>
      {% endif %}
      <span class="lb-post-metadata__time">
        <span class="relativeDate" data-js-timestamp="{{ postDate }}"  data-js-format="LT">{{- postDate -}}</span>
        <span>Uhr</span>
      </span>
      <span class="lb-post-metadata__date relativeDate" data-js-timestamp="{{ postDate }}" data-js-format="LL">
        {{- postDate -}}
      </span>

    </div>
    <!-- author plus avatar -->
    <div class="lb-author">
      {% if mainItem.commenter and not (item.syndication_in and not settings.showSyndicatedAuthor) %}
        <div class="lb-author__name">
          {{ translate('Comment by') }} {{ mainItem.commenter }}
        </div>
        <img class="lb-author__avatar lb-author__avatar--comment" src="{{ assets_root }}images/comment_icon.svg">
      {% elif settings.showAuthor %}
        <span class="lb-author__name">
        {% if mainItem.syndicated_creator and settings.showSyndicatedAuthor %}
          {{ mainItem.syndicated_creator.display_name }}
        {% elif item.original_creator %}
          {{ item.original_creator.display_name }}
        {% elif item.publisher %}
          {{ item.publisher.display_name }}
        {% endif %}
        {% if item.syndication_in and not settings.showSyndicatedAuthor %}
          <span class="lb-producer{% if settings.showSyndicatedAuthor %} lb-producer__author{% endif %}">{{ item.syndication_in.producer_blog_title }}</span>
        {% endif %}
      </span>
        {% if type == 'comment' %}
          <img class="lb-author__avatar lb-author__avatar--comment" src="{{ assets_root }}images/comment_icon.svg">
        {% endif %}
        {% if settings.showAuthorAvatar and type != 'comment' %}
          {% if mainItem.syndicated_creator and settings.showSyndicatedAuthor and mainItem.syndicated_creator.picture_url %}
          <img class="lb-author__avatar" src="{{ mainItem.syndicated_creator.picture_url }}" />
          {% elif item.original_creator and item.original_creator.picture_url %}
          <img class="lb-author__avatar" src="{{ item.original_creator.picture_url }}" />
          {% elif item.publisher and item.publisher.picture_url %}
          <img class="lb-author__avatar" src="{{ item.publisher.picture_url }}" />
          {% else %}
          <div class="lb-author__avatar"></div>
          {% endif %}
        {% endif %}
      {% endif %}
      {% endif %}
      <!-- end remove advertisement stylization-->
    </div>
    <!-- end author -->
  </div>
  {% endif %}
  <!-- end sticky position toggle -->
  {% if item.sticky %}
    {% include "template-item--sticky.html" %}
  {% else %}
    {% include "template-item.html" %}
      {% if settings.showUpdateDatetime and (item.content_updated_date != item.firstcreated) and item.post_items_type != "advertisement" -%}
        <div class="lb-post-updated">
          <span>{{ translate('Updated') }}</span> <span class="lb-post-updated-time relativeDate" data-js-timestamp="{{item.content_updated_date}}">{{item.content_updated_date}}</span>
        </div>
      {%- endif %}
    {% include "template-sharing.html" %}
  {% endif %}

</article>
